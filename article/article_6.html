<!DOCTYPE html>
<html lang="en">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <link rel="stylesheet" type="text/css" href="/blog/css/style.css">
    <title>graph stream sampl 测试记录</title>
    <meta name="description" content="">
</head>

<header>
<h2>CoolRiver</h2>
</header>

  <body>
 
    <div class="site-mid">
      <div class="site-bd markdown-body">
        
      <ul>
        
      </ul>

      <h2 id="graph-stream-sampl-">graph stream sampl 测试记录</h2>
<h3 id="-1-">替换算法1：随机替换</h3>
<pre><code class="lang-c"> <span class="hljs-comment">//随机删除已抽样的点，但不能删除正在添加的边中包含的点，否则造成VS和ES不匹配</span>
<span class="hljs-keyword">void</span> DelVertex(<span class="hljs-stl_container"><span class="hljs-built_in">map</span>&lt;<span class="hljs-keyword">int</span>,<span class="hljs-keyword">int</span>&gt;</span> &amp; VS,<span class="hljs-stl_container"><span class="hljs-built_in">multimap</span>&lt;<span class="hljs-keyword">int</span>,<span class="hljs-keyword">int</span>&gt;</span> &amp; ES,<span class="hljs-keyword">int</span> forbid)  
{
    <span class="hljs-stl_container"><span class="hljs-built_in">map</span>&lt;<span class="hljs-keyword">int</span>,<span class="hljs-keyword">int</span>&gt;</span>::iterator it,rm;
    <span class="hljs-keyword">int</span> rm_id,i,rm_vertex;
    it = VS.begin();
    rm = VS.begin();
    rm_id = rand()%VS.size();
    <span class="hljs-keyword">for</span> (i=<span class="hljs-number">0</span>;it != VS.end();it++,i++){  <span class="hljs-comment">//随机删除一个现有点和相关的边</span>
        <span class="hljs-keyword">if</span> (i == rm_id){
            rm_vertex = it-&gt;first;
            <span class="hljs-keyword">if</span> (rm_vertex == forbid){   <span class="hljs-comment">//不能删除这个点，再随机一次</span>
                <span class="hljs-built_in">cout</span>&lt;&lt;<span class="hljs-string">"!!!!!!!!!!!!!!!!1can not delete forbiden vertex : "</span>&lt;&lt;forbid&lt;&lt;endl;
                DelVertex(VS,ES,forbid);
            }
            <span class="hljs-keyword">else</span>{
                <span class="hljs-comment">//cout&lt;&lt;"remove vertex:"&lt;&lt;rm_vertex&lt;&lt;endl;</span>
                UpdateDegreeMap(it-&gt;second,-<span class="hljs-number">1</span>);
                VS.erase(it);
                DelEdge(ES,VS,rm_vertex);  <span class="hljs-comment">//删除与删除点相关的边</span>
            }
            <span class="hljs-keyword">break</span>;
        }
    }
}
</code></pre>
<h3 id="-2-">替换算法2：替换度最小的点</h3>
<pre><code class="lang-c"><span class="hljs-keyword">void</span> DelVertexMin(<span class="hljs-stl_container"><span class="hljs-built_in">map</span>&lt;<span class="hljs-keyword">int</span>,<span class="hljs-keyword">int</span>&gt;</span> &amp; VS,<span class="hljs-stl_container"><span class="hljs-built_in">multimap</span>&lt;<span class="hljs-keyword">int</span>,<span class="hljs-keyword">int</span>&gt;</span> &amp; ES,<span class="hljs-keyword">int</span> forbid)
{
    <span class="hljs-stl_container"><span class="hljs-built_in">map</span>&lt;<span class="hljs-keyword">int</span>,<span class="hljs-keyword">int</span>&gt;</span>::iterator it;
    <span class="hljs-keyword">int</span> rm_id,i,rm_vertex;
    it = VS.begin();
    <span class="hljs-comment">//rm = VS.begin();</span>
    <span class="hljs-keyword">bool</span> rm = <span class="hljs-keyword">false</span>;
    <span class="hljs-keyword">int</span> min_degree = <span class="hljs-number">1</span>;
    <span class="hljs-keyword">while</span>(<span class="hljs-keyword">true</span>){
        rm = <span class="hljs-keyword">false</span>;
        <span class="hljs-keyword">for</span> (;it != VS.end();it++){
            <span class="hljs-keyword">if</span> (it-&gt;second == min_degree &amp;&amp; it-&gt;first != forbid){   <span class="hljs-comment">//删除度最小的点</span>
                rm = <span class="hljs-keyword">true</span>;
                rm_vertex = it-&gt;first;
                <span class="hljs-comment">//cout&lt;&lt;"remove vertex:"&lt;&lt;rm_vertex&lt;&lt;" degree:"&lt;&lt;it-&gt;second&lt;&lt;endl;</span>

                UpdateDegreeMap(it-&gt;second,-<span class="hljs-number">1</span>);

                VS.erase(it);
                DelEdge(ES,VS,rm_vertex);  <span class="hljs-comment">//删除与删除点相关的边</span>
                <span class="hljs-keyword">break</span>;
            }
        }
        <span class="hljs-keyword">if</span> (rm){
            <span class="hljs-keyword">break</span>;
        }
        min_degree++;
    }
}
</code></pre>
<h3 id="-3-p-d-n-d-n-d-p-d-d-">替换算法3：以度的倒数为比例的概率替换点  p(d) = n / d;n为常数，d为度，p(d)为度为d的点被替换概率</h3>
<pre><code class="lang-c"><span class="hljs-keyword">void</span> DelVertexLine(<span class="hljs-stl_container"><span class="hljs-built_in">map</span>&lt;<span class="hljs-keyword">int</span>,<span class="hljs-keyword">int</span>&gt;</span> &amp; VS,<span class="hljs-stl_container"><span class="hljs-built_in">multimap</span>&lt;<span class="hljs-keyword">int</span>,<span class="hljs-keyword">int</span>&gt;</span> &amp; ES,<span class="hljs-keyword">int</span> forbid)
{
    <span class="hljs-keyword">double</span> pi;           <span class="hljs-comment">//计算每个度对应的替换概率</span>
    <span class="hljs-keyword">int</span> d_max = degreeMap.rbegin()-&gt;first + <span class="hljs-number">1</span>;  <span class="hljs-comment">//最大度数加1</span>
    <span class="hljs-keyword">long</span> sum = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">int</span> rm_vertex;
    <span class="hljs-keyword">float</span> random_value = <span class="hljs-number">0</span>;  <span class="hljs-comment">//随机值</span>
    <span class="hljs-keyword">float</span> add_value = <span class="hljs-number">0</span>;    <span class="hljs-comment">//累加值，当累加值大于随机值时替换掉当前点</span>
    <span class="hljs-stl_container"><span class="hljs-built_in">map</span>&lt;<span class="hljs-keyword">int</span>,pair&lt;<span class="hljs-keyword">int</span>,<span class="hljs-keyword">float</span>&gt;</span>&gt;::iterator it;
    <span class="hljs-stl_container"><span class="hljs-built_in">map</span>&lt;<span class="hljs-keyword">int</span>,<span class="hljs-keyword">int</span>&gt;</span>::iterator it_vs;

    <span class="hljs-keyword">for</span> (it = degreeMap.begin();it != degreeMap.end();it++){ <span class="hljs-comment">//求和sum</span>
        <span class="hljs-comment">//sum += (d_max - it-&gt;first) * it-&gt;second.first;</span>
        sum += ((<span class="hljs-keyword">float</span>)<span class="hljs-number">1.0</span> / it-&gt;first) * it-&gt;second.first;
    }

    <span class="hljs-keyword">for</span> (it = degreeMap.begin();it != degreeMap.end();it++){  <span class="hljs-comment">//计算每个度对应的概率</span>
        <span class="hljs-comment">//it-&gt;second.second = SAMPLE_SIZE * (float)(d_max - it-&gt;first) / sum;</span>
        it-&gt;second.second = SAMPLE_SIZE * ((<span class="hljs-keyword">float</span>)<span class="hljs-number">1.0</span> / it-&gt;first) / sum;
    }

    random_value = rand() % (SAMPLE_SIZE + <span class="hljs-number">1</span>);

    <span class="hljs-keyword">for</span> (it_vs = VS.begin();it_vs != VS.end();it_vs++){ 
        add_value += degreeMap.find(it_vs-&gt;second)-&gt;second.second;
        <span class="hljs-keyword">if</span> (add_value &gt;= random_value){
            <span class="hljs-keyword">if</span> (it_vs-&gt;first == forbid){ <span class="hljs-comment">//不能删除的点，再来一次</span>
                DelVertexLine(VS,ES,forbid);
            }
            <span class="hljs-keyword">else</span>{
                <span class="hljs-comment">//PrintDS();</span>
                <span class="hljs-comment">//cout&lt;&lt;"remove vertex:"&lt;&lt;it_vs-&gt;first&lt;&lt;" degree:"&lt;&lt;it_vs-&gt;second&lt;&lt;endl;</span>

                rm_vertex = it_vs-&gt;first;
                UpdateDegreeMap(it_vs-&gt;second,-<span class="hljs-number">1</span>);
                VS.erase(it_vs);
                DelEdge(ES,VS,rm_vertex);  <span class="hljs-comment">//删除与删除点相关的边</span>
                <span class="hljs-keyword">break</span>;
            }
        }
    }

<span class="hljs-comment">//    PrintDS();</span>

}
</code></pre>
<h3 id="-email-enron-txt-dis">测试数据集：Email-Enron.txt 测试对象：度分布系数DIS</h3>
<table>
    <tr>
        <th rowspan="2">抽样方法</th>
        <th colspan="4">抽样比例</th>
    </tr>

    <tr>
        <th>5%</th>
        <th>10%</th>
        <th>20%</th>
        <th>30%</th>
    </tr>

    <tr>
        <td>原图DIS</td>
        <td>2.09</td>
        <td>2.09</td>
        <td>2.09</td>
        <td>2.09</td>
    </tr>

    <tr>
        <td>普通边抽样，随机替换</td>

        <td>11.50</td>
        <td>7.52</td>
        <td>5.33</td>
        <td>4.16</td>
    </tr>

    <tr>
        <td>PIE,随机替换</td>

        <td>3.77</td>
        <td>3.30</td>
        <td>2.93</td>
        <td>2.77</td>
    </tr>
    <tr>
        <td>PIE,替换度最小点</td>

        <td>1.73</td>
        <td>1.63</td>
        <td>1.62</td>
        <td>1.65</td>
    </tr>
    <tr>
        <td>PIE,p(d) = λ(dmax - d)</td>

        <td>3.55</td>
        <td>3.23</td>
        <td>2.89</td>
        <td>2.74</td>
    </tr>
    <tr>
        <td>PIE,p(d) = λ*pow(2,-d)</td>

        <td>1.44</td>
        <td>1.50</td>
        <td>1.63</td>
        <td>1.40</td>
    </tr>
    <tr>
        <td>PIE,p(d) = λ/d</td>
        <td>2.04</td>
        <td>1.96</td>
        <td>1.93</td>
        <td>1.91</td>
    </tr>


</table>


    
      </div>
    </div>

    <div class="site-lt">
      <div class="lt-list">
        <div class="list-title">文章列表</div>
        <ul id="ul-title">
          loading....
        </ul>
      </div>
      
    </div>

    <div class="site-rt">
      
    </div>

      <div class="site-ft">
            <small>&copy; 2014</small>
      </div>

     <script type="text/javascript" src="/blog/js/main.min.js"></script>
    
  </body>
</html>